# 5 SQLAlchemy
## 5.1 ORM
**ORM全称 Object Relational Mapping对象关系映射**

通过 ORM 可以不用关心后台是使用的哪种数据库，只需要按照 ORM 所提供的语法规则去书写相应的代码， ORM 就会自动的转换成对应对应数据库的 SQL 语句

## 5.2 SQLAIchemy连接数据库
### 5.2.1 安装
#### 5.2.1.1 安装mysql
Mysql安装教程连接:
#### 5.2.1.2 安装python包`pymysql`、`sqlalchemy`
1. pymysql安装:`pip install pymysql`
2. sqlalchemy安装:`pip install sqlalchemy`

#### 5.2.2 导入create_engine模块
db.py代码
```
from sqlalchemy import create_engine
```

#### 5.2.3  数据库连接配置

```
HOSTNAME = '127.0.0.1'
PORT = '3306'
DATABASE = 'mysql'
USERNAME = 'leva'
PASSWORD = 'leva123'
```

#### 5.2.4 数据库连接URL
```
# 第一种数据库连接
DB_url = 'mysql+pymysql://%s:%s@%s:%s/%s?charset=utf8' %(
    USERNAME,
    PASSWORD,
    HOSTNAME,
    PORT,
    DATABASE
)

# 第二种数据库连接 
DB_url = 'mysql+pymysql://{}:{}@{}:{}/{}?charset=utf8'.format(
    USERNAME,
    PASSWORD,
    HOSTNAME,
    PORT,
    DATABASE
)
```

#### 5.2.5 数据库连接
```
engine = create_engine(DB_url)
```

#### 5.2.6 测试数据库
```
if __name__== '__main__':
    connection = engine.connect()
    result = connection.execute('select 1')
    print(result)
```
#### 5.2.7 创建一个基类
```
from sqlalchemy.ext.declarative import declarative_base
Base = declarative_base(engine)
```
1. 对象关系型映射，数据库中的表与python中的类相对应，创建的类必须继承自 sqlalchemy 中的基类。
2. 使用 declarative 方法定义的映射类依据一个基类，这个基类是维系类和数据表关系的目录。
3. 应用通常只需要有一个 Base 的实例。我们通过 declarative_base() 功能创建一个基类。
```
from sqlalchemy import create_engine #create_engine模块
from sqlalchemy.ext.declarative import declarative_base #导入一个基类模块

HOSTNAME = '127.0.0.1'
PORT = '3306'
DATABASE = 'mydb'
USERNAME = 'leva'
PASSWORD = 'leva123'

DB_url = 'mysql+pymysql://{}:{}@{}:{}/{}?charset=utf8'.format(
    USERNAME,
    PASSWORD,
    HOSTNAME,
    PORT,
    DATABASE
)

engine = create_engine(DB_url)

Base = declarative_base(engine) # 这个Base类就是基类
```
## 5.3 Module
**通过SQLALchemy提供的语法来声明表**
1. __tablename__: 数据库中表名
2. Column: 用来创建表中的字段的一个方法
3. Integer: 整型，映射到数据库中的类型
4. String: 字符类型，映射到数据库中的类型，使用时，需要提供一个字符长度
5. DateTime:  时间类型

### 5.3.1 创建数据库模型
```
from connect import Base
from datetime import datetime
from sqlalchemy import Column, Integer, String, Boolean, DateTime
```

1. 再次强调，我们用类来表示数据库里面的表！！！
2. 这些表的类都继承于我们的Base基类。
3. 在类里面我们定义一些属性，这个属性通过映射，就对应表里面的字段
user_modules.py代码
```
from connect import Base
from datetime import datetime
from sqlalchemy import Column, Integer, String, Boolean, DateTime

class User(Base):
    """建立数据库模型对应User表"""
    __tablename__ = 'user'
    id = Column(Integer,primary_key=True,autoincrement=True)
    username = Column(String(20))
    password = Column(String(20))
    creat_time = Column(DateTime,default=datetime.now())
    _locked = Column(Boolean,default=False,nullable=False)

if __name__ == "__main__":
    Base.metadata.create_all() #执行此代码，就会把创建好的 Module 映射到数据库中
``` 
## 5.4 增删改查
## 5.5 查询结果
## 5.6 条件查询
## 5.7 多表查询
## 5.8 原生sql查询
## 5.9 一对一表关系
## 5.10 多对多表关系
## 5.11 包管理
## 5.12 简单的登录