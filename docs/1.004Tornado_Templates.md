# 4 Templates
模板就是html文件，只是其中加入了模板语法，需要服务器的渲染，才能正常显示数据
## 4.1 模板
1. 之前我们通过render可以返回一个html页面，不过那都是固定的页面，固定的数据，但是如果数据是不确定的，是会不断改变的，该怎么做呢？
2. 是否可以先把页面写好，然后预留出固定的位置，在需要的时候再填入数据即可？

### 4.1.1 配置路径
在 application 中配置模板文件和静态文件的路径：
```
app = tornado.web.Application(
    template_path = 'templates', # 模板路径
)
```

### 4.1.2 模板调用案例
模板使用后台代码示例
```
class TemplatesHandler(tornado.web.RequestHandler):
    def get(self):
        self.render('login.html')

    def post(self):
        user = self.get_argument('name',None)
        passwd = self.get_argument('password',None)
        self.render('templates.html',username = user,passwd = passwd)

app = tornado.web.Application(
    handlers = [
        (r'/temp',TemplatesHandler),
        (r'/login',LoginHandler),

    ],
    template_path = 'templates',
)

```
模板login.html代码
```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tornado</title>
</head>
<body>
 <form method="post" action="/temp" >
    <p>用户名<br>
        <input type="text" name="name">
    </p>
     <p>密码<br>
         <input type="password" name="password">
     </p>
     <input type="submit">
 </form>
</body>
</html>
```
模板templates.html代码
```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

欢迎《 {{ username }} 》登录
<br>
密码: {{ passwd }}
</body>
</html>
```

## 4.2 模板语法
既然有了模板，那模板的语法规则是怎样的呢？
### 4.2.1 模板符号
`{{ expression }}`用 {{ expression }} 中间是任何 python 表达式，或者是一个变量
示例
test.py代码
```
class TemplatesHandler(tornado.web.RequestHandler):
    def get(self):
        import time  #导入时间模块
        self.render('templates.html',time =time) # 插入调用时间模块time=time
```
templates.html代码
```
{{ 1 + 1 }}  <!--  可以是 python中的一个表达式或者一个变量-->
{{ time.time() }}  <!--  时间模块调用-->
```

`{%  directives %}`其他的模板指令
示例
```
{% if 1==2 %}<br> <!-- 判断语句-->
    判断结果成立

{% else %}<br>
    判断结果不成立

{% end %}
```

`{#  … #}`在模板中要注释python表达式的运行，需要使用这个模板语法
示例
```
{# time.time()#} <!--注释模板方法-->
```

`{{!   {%!   {#!`如果不想执行内容，需要在页面上打印出模板符号，只需要加上感叹号( ! )即可
示例
```
{{! 1 + 1}}

{%! if 1 %}     this is if {%! end %}

{#! time.time() #}}
```

### 4.2.2 控制语句 if判断

在模板中可以使用 `if` 判断,最后需要以 `{% end %}` 结尾

#### 4.2.2.1 if判断示例
test.py代码
```
class TemplatesHandler(tornado.web.RequestHandler):
    def get(self):
        self.render('login.html')

    def post(self):
        user = self.get_argument('name','no')
        self.render('templates.html',user = user,)
```
login.html代码
```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tornado</title>
</head>
<body>
 <form method="post" action="/temp" >
    <p>用户名<br>
        <input type="text" name="name">
    </p>
     <p>密码<br>
         <input type="password" name="password">
     </p>
     <input type="submit">
 </form>
</body>
</html>
```
templates.html代码
```
{% if user == '' %}
    未登录

{% else%}
    欢迎 {{ user}} 登录

{% end %}

```
### 4.2.3 循环语句 for and while
#### 4.2.3.1 for循环
在`tornado` 模板中可以使用 for 循环,最后需要以 `{% end %}`结尾

test.py代码
```
class TemplatesHandler(tornado.web.RequestHandler):
    def get(self):
        # self.render('login.html')
        urllist = [
            ('http://www.baidu.com','百度一下'),
            ('http://www.zhihu.com','知乎'),
            ('http://www.sina.com.cn','新浪'),
        ]
        self.render('templates.html', list=urllist)
```

templates.html代码
```
{% for i in list %}

    <a href="{{ i[0] }}" target="_blank">{{ i[1] }}</a><br>

{% end%}
```

#### 4.2.3.2 while循环
在 tornado 模板中可以使用 `while` 循环,最后需要以 `{% end %}` 结尾

test.py代码
```

```

templates.html代码
```
{% set a = 0%}  # 模板中定义变量需要加set

    {% while a<5 %}
        {{ a }}<br>
        {% set a += 1 %}

{% end %}
```

### 4.2.4 模板语法总结
1. `{{ … }}`:此符号中放入任意 python 表达式，或者模板中的变量
2. `{% … %} {% end %}`:此符号中放入模板中的命令，比如`if 、for`和`while`等需要注意的是，使用`if`等命令是，需要加上`{% end%}`除此之外，异常处理`try`也可以在模板中使用，但是这样做会让模板变得像 python 模块一样，因此并不建议大家这么做
3. `{# #}`:模板中的注释语句，可以让模板中指令不执行

### 4.2.5 模板符号总结
1. 必须掌握:`{{、{%、{#`三个符号的作用
2. 必须掌握:`{% if %} … {% end %}`的用法
3. 必须掌握:`{% for … %} … {% end %}{% while … %} … {% end %}`的用法

## 4.3 模板转义
通过模板，可以把数据动态的添加到页面，如果添加的值是一段html代码的话，会不会被执行呢？
* 局部:`raw`在局部去转义，使用之后不会转义
* 模块:`escape`、`{% autoescape None %}`在模板中去转义，整个模板中默认不在转义
在不转义之后，可以使用 escape 转义
* 全局:`autoescape=None`在 Application 中添加此配置项，则整个项目不再转义

### 4.3.1 转义
* 页面并没有解析，只是当作一个字符串，直接在页面上打印出来
* tornado默认是自动的转义，传入的数据都会当作字符串，不会被浏览器解析

test.py代码
`atga = "<a href='https://www.baidu.com'target='_blank'>___百度___</a><br>"`
```
class TemplatesHandler(tornado.web.RequestHandler):
    def get(self):
        atga = "<a href='https://www.baidu.com'target='_blank'>___百度___</a><br>"
        self.render('templates.html', atga= atga)
```
templates.html代码
```
{{atga}}<br>  <!-- 转义-->
```


### 4.3.2 raw 局部去掉转义
raw 可以自模板中去掉转义，让 tornado 在渲染的时候不去转义变量

test.py代码
```
class TemplatesHandler(tornado.web.RequestHandler):
    def get(self):
        atga = "<a href='https://www.baidu.com'target='_blank'>___百度___</a><br>"
        self.render('templates.html', atga= atga)
```

templates.html代码
```
{% raw atga %}
```

### 4.3.3  escape 局部开启转义
在开启模板不转义之后，可以使用 escape 来添加转义

test.py代码
`atga = "<a href='https://www.baidu.com'target='_blank'>___百度___</a><br>"`
```
class TemplatesHandler(tornado.web.RequestHandler):
    def get(self):
        atga = "<a href='https://www.baidu.com'target='_blank'>___百度___</a><br>"
        self.render('templates.html', atga= atga)
```
templates.html代码
```
{{ escape(atga)}} # 局部开启转义
```

### 4.3.4 模板去掉转义
#### 4.3.4.1 模板去转义
`autoescape None`在模板中添加上面代码之后，当前模板不再转义
```
<!DOCTYPE html>
{% autoescape None%} <!--单个页面全局取消转义--->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
{{atga}}<br> 
{{atga}}<br>
{{atga}}<br>
</body>
</html>
```

### 4.3.5 全局去掉转义
在 Application 中添加如下配置：
```
autoescape=None,
```
`autoescape`去掉整个项目的转义，配置之后，整个项目中的模板不再转义

### 4.3.6 模板转义总结
1. 局部去转义 必须掌握:raw的用法和作用
2. 模板去转义 必须掌握:模板去转义的方法和escape作用和用法
3. 全局去转义 必须掌握:Tornado全局去转义的方法


## 4.4 静态文件引用
模板中如何引用图片等静态文件呢？


### 4.4.1 Application
```
app = tornado.web.Application(
    static_path = 'static',
)
```
### 4.4.2 路由配置
添加此配置之后，tornado就能自己找到静态文件

### 4.4.3 两种映入方式
```
<img src="{{ static_url('images/c.jpg') }}" width="250" height="250"> <img src="static/images/c.jpg" width="250" height="250">
```
### 4.4.4 static
`<img src="static/images/c.jpg" width="250" height="250">`

### 4.4.5 自动查找
在 Tornado 模板中，static 是个关键词，能够自动替换成 static_path 后的内容

### 4.4.6 static_url
`<img src="{{ static_url('images/c.jpg') }}" width="250" height="250">`

### 4.4.7 添加版本号
使用此方法时，Tornado会自动地给静态文件添加版本号，如果版本号更改了，浏览器会自动的缓存新的静态文件

### 4.4.8 静态文件的引用
必须掌握:tornado中静态文件来那两种引入方式

## 4.5 模板继承
## 4.6 函数和类导入
## 4.7 un_methodes和ui_modules
## 4.8 模板其他